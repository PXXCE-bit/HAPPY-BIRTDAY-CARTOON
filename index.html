<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>üéÑ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</title>

<style>
:root{
--bg:#070a18;
--fg:#eaf2ff;
--muted:#a9b7df;
--accent:#66ffcc;
--danger:#ff6b6b;
--card: rgba(10,16,40,.62);
--border: rgba(255,255,255,.12);
--gold: #ffd966;
}
*{ box-sizing:border-box; }

body{
margin:0;
min-height:100vh;
font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
background: radial-gradient(1100px 520px at 50% 15%, #1b2a66, var(--bg));
color:var(--fg);
overflow-y:auto;
overflow-x:hidden;
-webkit-overflow-scrolling:touch;
}

canvas{ position:fixed; inset:0; pointer-events:none; }
#snow{ z-index:0; }
#confetti{ z-index:1; }
#fire{ z-index:1; }

.lights{
position:fixed;
left:0; right:0; top:0;
height:44px;
pointer-events:none;
z-index:2;
display:flex;
gap:10px;
padding:10px 12px;
opacity:.95;
}
.lights i{
width:10px; height:18px;
border-radius:999px;
animation:twinkle 1.2s infinite ease-in-out;
}
.lights i:nth-child(3n){ animation-delay:.2s; }
.lights i:nth-child(4n){ animation-delay:.4s; }
.lights i:nth-child(5n){ animation-delay:.6s; }
@keyframes twinkle{
0%,100%{ opacity:.35; transform:translateY(0); filter:saturate(1); }
50%{ opacity:1; transform:translateY(1px); filter:saturate(1.8); }
}

.wrap{
position:relative;
z-index:3;
width:min(980px,94vw);
margin:70px auto 24px;
padding:14px;
display:grid;
gap:12px;
grid-template-columns: 1.1fr .9fr;
}
@media(max-width:980px){
.wrap{ grid-template-columns:1fr; margin-top:62px; }
}

.card{
background:var(--card);
border:1px solid var(--border);
border-radius:18px;
box-shadow:0 22px 70px rgba(0,0,0,.5);
backdrop-filter: blur(10px);
padding:18px;
}

h1{ margin:0 0 6px 0; font-size:20px; }
.sub{ margin:0 0 12px 0; color:var(--muted); font-size:13px; }
.row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.panel{
border:1px solid rgba(255,255,255,.12);
border-radius:16px;
padding:14px;
background:rgba(0,0,0,.20);
}
.big{ font-size:26px; line-height:1.2; margin:0; }
.prompt{ color:var(--accent); }
.err{ min-height:18px; color:var(--danger); font-size:13px; margin-top:8px; }

input, button{
border-radius:12px;
border:1px solid rgba(255,255,255,.15);
background:rgba(0,0,0,.22);
color:var(--fg);
padding:12px 12px;
outline:none;
font:inherit;
}
input{ flex:1; min-width:220px; }
button{
cursor:pointer;
background: linear-gradient(135deg, rgba(102,255,204,.22), rgba(134,168,255,.16));
user-select:none;
-webkit-user-select:none;
-webkit-touch-callout:none;
}
button:hover{ transform: translateY(-1px); }
button:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

.bar{
width:100%;
height:10px;
border-radius:999px;
background:rgba(255,255,255,.10);
overflow:hidden;
border:1px solid rgba(255,255,255,.12);
}
.fill{
height:100%;
width:0%;
background:linear-gradient(90deg, rgba(102,255,204,.9), rgba(134,168,255,.9));
}

.gallery{ display:grid; gap:10px; }
.photo{
width:100%;
aspect-ratio:16/10;
border-radius:14px;
border:1px solid rgba(255,255,255,.12);
background:rgba(0,0,0,.22);
overflow:hidden;
display:flex;
align-items:center;
justify-content:center;
position:relative;
}
.photo img{ width:100%; height:100%; object-fit:cover; display:block; }
.cap{
position:absolute;
left:10px;
bottom:10px;
padding:6px 10px;
border-radius:999px;
background:rgba(0,0,0,.42);
border:1px solid rgba(255,255,255,.14);
font-size:12px;
backdrop-filter: blur(6px);
}

.hidden{ display:none !important; }

.letter{
white-space:pre-wrap;
line-height:1.85;
font-size:14px;
}
.cursor{
display:inline-block;
width:8px;
margin-left:2px;
opacity:.9;
animation: blink .9s steps(2,start) infinite;
}
@keyframes blink{ 50%{ opacity:0; } }

.hl{
color: var(--gold);
font-weight: 700;
text-shadow: 0 0 10px rgba(255,217,102,.22);
}

.toast{
position:fixed;
left:50%;
top:52px;
transform:translateX(-50%);
padding:10px 12px;
border-radius:12px;
background:rgba(0,0,0,.55);
border:1px solid rgba(255,255,255,.14);
color:var(--fg);
font-size:13px;
opacity:0;
pointer-events:none;
transition: opacity .25s ease, transform .25s ease;
z-index:5;
text-align:center;
max-width:min(92vw,520px);
}
.toast.show{
opacity:1;
transform:translateX(-50%) translateY(4px);
}

/* ===== Intro envelope (‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á) ===== */
.envelope{
width: min(520px, 92vw);
margin: 0 auto;
border-radius: 18px;
background: rgba(255,255,255,.06);
border: 1px solid rgba(255,255,255,.14);
padding: 16px;
position: relative;
overflow: hidden;
}

.env-stage{
position:relative;
height: 210px;
border-radius: 16px;
border:1px solid rgba(255,255,255,.10);
background:
radial-gradient(220px 120px at 30% 10%, rgba(255,255,255,.12), transparent),
linear-gradient(135deg, rgba(255,255,255,.10), rgba(0,0,0,.10));
overflow:hidden;
}

.paper{
position:absolute;
left:50%;
bottom:18px;
width: 78%;
height: 155px;
transform: translateX(-50%) translateY(120px);
border-radius: 12px;
background:
linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
border:1px solid rgba(0,0,0,.08);
box-shadow: 0 18px 40px rgba(0,0,0,.35);
opacity:.96;
}
.paper:before{
content:"";
position:absolute;
inset:12px;
border-radius: 10px;
border:1px dashed rgba(0,0,0,.12);
}
.paper .paperText{
position:absolute;
left:14px; right:14px; top:18px;
color:#1b2a66;
font-weight:700;
font-size:12px;
opacity:.85;
letter-spacing:.2px;
}

.env-body{
position:absolute;
left:50%;
bottom:0;
width: 86%;
height: 120px;
transform: translateX(-50%);
border-radius: 14px;
background: rgba(0,0,0,.20);
border: 1px solid rgba(255,255,255,.14);
backdrop-filter: blur(6px);
overflow:hidden;
}
.env-body:before{
content:"";
position:absolute;
inset:0;
background: linear-gradient(180deg, rgba(255,255,255,.10), transparent);
opacity:.5;
}

.flap{
position:absolute;
left:50%;
bottom: 88px;
width: 86%;
height: 92px;
transform: translateX(-50%);
transform-origin: 50% 100%;
background: rgba(0,0,0,.22);
border: 1px solid rgba(255,255,255,.14);
border-bottom:none;
clip-path: polygon(0 100%, 50% 0, 100% 100%);
border-radius: 14px;
box-shadow: 0 12px 30px rgba(0,0,0,.35);
}

.sparkle{
position:absolute;
inset:0;
pointer-events:none;
opacity:0;
background:
radial-gradient(4px 4px at 20% 30%, rgba(255,217,102,.95), transparent 60%),
radial-gradient(3px 3px at 60% 24%, rgba(255,217,102,.85), transparent 60%),
radial-gradient(4px 4px at 75% 45%, rgba(255,217,102,.95), transparent 60%),
radial-gradient(3px 3px at 40% 55%, rgba(255,217,102,.85), transparent 60%),
radial-gradient(4px 4px at 55% 70%, rgba(255,217,102,.95), transparent 60%);
filter: drop-shadow(0 0 10px rgba(255,217,102,.22));
}

.env-open .flap{ animation: flapOpen .9s ease forwards; }
.env-open .paper{ animation: paperUp 1.05s ease forwards; }
.env-open .sparkle{ animation: sparkle 1.2s ease forwards; }
@keyframes flapOpen{
0%{ transform: translateX(-50%) rotateX(0deg); }
100%{ transform: translateX(-50%) rotateX(160deg); }
}
@keyframes paperUp{
0%{ transform: translateX(-50%) translateY(120px); }
70%{ transform: translateX(-50%) translateY(2px); }
100%{ transform: translateX(-50%) translateY(12px); }
}
@keyframes sparkle{
0%{ opacity:0; }
30%{ opacity:1; }
100%{ opacity:0; }
}

.env-mid{
margin-top: 12px;
padding: 14px;
border-radius: 14px;
background: rgba(0,0,0,.22);
border:1px solid rgba(255,255,255,.12);
text-align:center;
}

.fingerWrap{ display:flex; justify-content:center; margin-top:12px; }
.finger{
width:110px; height:110px; border-radius:999px;
border:1px solid rgba(255,255,255,.16);
background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.14), rgba(0,0,0,.20));
box-shadow: 0 18px 50px rgba(0,0,0,.35);
display:flex; align-items:center; justify-content:center;
position:relative;
touch-action:none;
}
.finger svg{ width:64px; height:64px; opacity:.92; filter: drop-shadow(0 8px 18px rgba(0,0,0,.35)); }
.ring{
position:absolute; inset:8px;
border-radius:999px;
border:2px solid rgba(255,255,255,.10);
}
.ring::after{
content:"";
position:absolute;
inset:-2px;
border-radius:999px;
border:2px solid rgba(102,255,204,.85);
clip-path: var(--wedge, polygon(50% 50%, 50% 0, 50% 0, 50% 50%));
opacity:0;
}
.finger.holding .ring::after{ opacity:1; }
.holdText{ margin-top:10px; color:var(--muted); font-size:13px; }

/* ===== Timing game ===== */
.timingBox{
border-radius:14px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.22);
padding:14px;
}
.timingTrack{
position:relative;
height: 16px;
border-radius:999px;
background: rgba(255,255,255,.10);
border:1px solid rgba(255,255,255,.12);
overflow:hidden;
}
.timingZone{
position:absolute; top:0; bottom:0;
left: 42%;
width: 16%;
background: linear-gradient(90deg, rgba(255,217,102,.35), rgba(255,217,102,.65));
border-left: 1px solid rgba(255,255,255,.18);
border-right: 1px solid rgba(255,255,255,.18);
}
.timingPointer{
position:absolute;
top:-10px;
width: 10px;
height: 36px;
border-radius: 8px;
background: rgba(102,255,204,.95);
box-shadow: 0 12px 25px rgba(102,255,204,.18);
left:0%;
transform: translateX(-50%);
}
.badge{
display:inline-flex;
align-items:center;
gap:8px;
padding:8px 10px;
border-radius:999px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.22);
color:var(--muted);
font-size:12px;
}

/* ===== Countdown ===== */
.countGrid{
display:grid;
grid-template-columns: repeat(4, 1fr);
gap:10px;
margin-top:10px;
}
@media(max-width:680px){
.countGrid{ grid-template-columns: repeat(2, 1fr); }
}
.stat{
border-radius:14px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.22);
padding:12px;
text-align:center;
}
.stat .num{
font-size:20px;
font-weight:800;
color: var(--gold);
text-shadow: 0 0 12px rgba(255,217,102,.20);
}
.stat .lab{
font-size:12px;
color:var(--muted);
margin-top:4px;
}

/* ===== Gift ===== */
.giftBox{
margin-top:12px;
border-radius:14px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.22);
padding:14px;
}
.coupon{
margin-top:10px;
border-radius:14px;
border:1px dashed rgba(255,217,102,.45);
background: rgba(255,217,102,.08);
padding:12px;
color: var(--fg);
}
.coupon .title{
font-weight:900;
color: var(--gold);
margin-bottom:6px;
}
</style>
</head>

<body>
<canvas id="snow"></canvas>
<canvas id="confetti"></canvas>
<canvas id="fire"></canvas>
<div class="lights" id="lights" aria-hidden="true"></div>
<div class="toast" id="toast"></div>

<div class="wrap">
<!-- LEFT -->
<div class="card">
<h1>üéÑ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î (PEACE ‚Üí Cartoon)</h1>
<p class="sub">‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏∑‡∏≠ ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á ‚Üí ‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏Ñ‡∏ö ‚Üí ‡πÄ‡∏Å‡∏° Timing ‚Üí ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å ‚Üí ‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‚Üí ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏•‡∏±‡∏ö</p>

<!-- Progress -->
<div class="panel">
<div class="row" style="justify-content:space-between;">
<div class="sub">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
<div class="sub">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô <span id="stepLabel">0</span>/10</div>
</div>
<div class="bar" style="margin-top:8px"><div class="fill" id="fill"></div></div>
</div>

<!-- INTRO -->
<div class="panel" id="introPanel" style="margin-top:12px">
<p class="big">‚úâÔ∏è ‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏±‡∏ö</p>
<p class="sub">‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å</p>

<div class="envelope">
<div class="env-stage" id="envStage">
<div class="sparkle"></div>
<div class="paper">
<div class="paperText">To: Cartoon üíõ</div>
</div>
<div class="flap"></div>
<div class="env-body"></div>
</div>

<div class="env-mid">
<div class="sub" style="margin:0">‡πÇ‡∏õ‡∏£‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏∑‡∏≠</div>

<div class="fingerWrap">
<div class="finger" id="finger">
<div class="ring"></div>
<svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
<path d="M12 3c-4 0-7 3-7 7v3c0 3.314 2.686 6 6 6h1" stroke="rgba(234,242,255,.92)" stroke-width="1.6" stroke-linecap="round"/>
<path d="M12 6c-2.5 0-4 1.8-4 4v3c0 2.2 1.8 4 4 4" stroke="rgba(234,242,255,.92)" stroke-width="1.6" stroke-linecap="round"/>
<path d="M12 9c-1.4 0-2 1.1-2 2.5V13c0 1.8 1.2 3 3 3" stroke="rgba(234,242,255,.92)" stroke-width="1.6" stroke-linecap="round"/>
<path d="M15 10.5V13c0 3 2 5 5 5" stroke="rgba(102,255,204,.9)" stroke-width="1.6" stroke-linecap="round"/>
</svg>
</div>
</div>

<div class="holdText" id="holdText">‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏∑‡∏≠</div>
</div>
</div>

<div class="row" style="margin-top:12px; justify-content:space-between;">
<button id="btnFxIntro">üéÜ ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå</button>
<span class="badge">Tip: iPad ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
</div>
</div>

<!-- COUPLE DAY PANEL -->
<div class="panel hidden" id="lovePanel" style="margin-top:12px">
<p class="big">üíû ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</p>
<p class="sub">
‡∏Ñ‡∏ö‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà <span class="prompt">18/12/2565</span><br>
‡∏Ñ‡∏£‡∏ö 3 ‡∏õ‡∏µ‡∏ó‡∏µ‡πà <span class="prompt">18/12/2568</span> = <span class="prompt">1,096 ‡∏ß‡∏±‡∏ô</span>
</p>

<div class="countGrid">
<div class="stat"><div class="num" id="dNow">‚Äî</div><div class="lab">‡∏ß‡∏±‡∏ô (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏ö‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß)</div></div>
<div class="stat"><div class="num" id="hNow">‚Äî</div><div class="lab">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</div></div>
<div class="stat"><div class="num" id="mNow">‚Äî</div><div class="lab">‡∏ô‡∏≤‡∏ó‡∏µ</div></div>
<div class="stat"><div class="num" id="sNow">‚Äî</div><div class="lab">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div></div>
</div>

<div class="row" style="margin-top:12px; justify-content:flex-end;">
<button id="btnLoveNext">‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠ ‚ñ∂</button>
</div>
</div>

<!-- GAME: Timing bar -->
<div class="panel hidden" id="gamePanel" style="margin-top:12px">
<p class="big">‡πÄ‡∏Å‡∏°: Timing Bar</p>
<p class="sub">‡∏Å‡∏î ‚Äú‡∏´‡∏¢‡∏∏‡∏î‚Äù ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô ‚Äú‡πÇ‡∏ã‡∏ô‡∏™‡∏µ‡∏ó‡∏≠‡∏á‚Äù ‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>

<div class="timingBox">
<div class="timingTrack">
<div class="timingZone"></div>
<div class="timingPointer" id="timingPointer"></div>
</div>
<div class="row" style="margin-top:12px; justify-content:space-between;">
<span class="badge">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <span id="timingWin">0</span>/2</span>
<span class="badge">‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°: <span id="timingTry">0</span>/3</span>
</div>
</div>

<div class="row" style="margin-top:12px">
<button id="btnTimingStart">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
<button id="btnTimingStop" disabled>‡∏´‡∏¢‡∏∏‡∏î</button>
<button id="btnTimingReset">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
</div>
<div class="err" id="timingErr"></div>
</div>

<!-- ======= ORIGINAL FLOW (‡πÄ‡∏î‡∏¥‡∏°) ======= -->
<div class="panel hidden" id="gatePanel" style="margin-top:12px">
<p class="big">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å</p>
<p class="sub">
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: <span class="prompt">‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á Cartoon ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</span><br>
(‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö <span class="prompt">DD/MM/YYYY</span>)
</p>

<div class="row" style="margin-top:10px">
<input id="startPw" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î (DD/MM/YYYY)..." autocomplete="off" />
<button id="btnStart">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
</div>
<div class="err" id="startErr"></div>

<div class="row" style="margin-top:12px; justify-content:space-between;">
<button id="btnPlay1">‚ñ∂ ‡πÄ‡∏•‡πà‡∏ô/‡∏´‡∏¢‡∏∏‡∏î ‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
<button id="btnFxGate">üéÜ ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå</button>
</div>

<audio id="song1" preload="auto" controls style="width:100%; margin-top:10px;"></audio>
<div class="sub" style="margin-top:8px;">
‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: iPad/iPhone ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏≠‡∏á 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î iOS)
</div>
</div>

<div class="panel hidden" id="missionPanel" style="margin-top:12px">
<p class="big" id="missionTitle">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</p>
<p class="sub" id="missionDesc"></p>

<div class="row">
<input id="missionInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö/‡∏£‡∏´‡∏±‡∏™..." autocomplete="off" />
<button id="btnSubmit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
</div>
<div class="err" id="missionErr"></div>

<div class="row" style="margin-top:12px; justify-content:flex-end;">
<button id="btnFxMission">üéâ ‡πÇ‡∏õ‡∏£‡∏¢ / üéÜ ‡∏û‡∏•‡∏∏</button>
</div>
</div>

<div class="panel hidden" id="letterPanel" style="margin-top:12px">
<div class="row" style="justify-content:space-between; align-items:flex-start;">
<div>
<p class="big" style="margin-bottom:6px;">üì© ‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á Cartoon</p>
<p class="sub" style="margin-top:0;">‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡∏µ‡∏î (‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ)</p>
</div>
<button id="btnTypeSound">üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡∏µ‡∏î: ‡πÄ‡∏õ‡∏¥‡∏î</button>
</div>

<div class="letter" id="letterText"></div>
<div class="row" style="margin-top:12px; justify-content:flex-end;">
<button id="btnNextAfterLetter" disabled>‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
</div>
</div>

<div class="panel hidden" id="colorPanel" style="margin-top:12px">
<p class="big">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
<p class="sub">‡πÉ‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ‚Äú‡∏™‡∏µ‚Ä¶‚Äù ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</p>
<div class="row">
<input id="colorInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö..." autocomplete="off" />
<button id="btnColor">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
</div>
<div class="err" id="colorErr"></div>
</div>

<div class="panel hidden" id="finalPanel" style="margin-top:12px">
<p class="big">üéâ Happy Birthday Cartoon</p>
<p class="sub">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚úÖ</p>

<div class="row" style="justify-content:space-between;">
<button id="btnPlay2">‚ñ∂ ‡πÄ‡∏•‡πà‡∏ô/‡∏´‡∏¢‡∏∏‡∏î ‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</button>
<button id="btnGift">‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏•‡∏±‡∏ö üéÅ</button>
</div>

<audio id="song2" preload="auto" controls style="width:100%; margin-top:10px;"></audio>

<div class="giftBox hidden" id="giftBox">
<div class="sub" style="margin:0;">‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö</div>
<div class="coupon" id="coupon"></div>
</div>
</div>
</div>

<!-- RIGHT -->
<div class="card">
<h1>üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å</h1>
<p class="sub">‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>

<div class="gallery">
<div class="photo" id="imgBox1"><div class="sub">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1 (‡∏´‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à 1)</div></div>
<div class="photo" id="imgBox2"><div class="sub">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2 (‡∏´‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à 2)</div></div>
<div class="photo" id="imgBox3"><div class="sub">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 3 (‡∏´‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à 3)</div></div>
</div>

<div class="panel" style="margin-top:12px">
<div class="sub">
‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô repo (root):<br>
<span class="prompt">p1.jpg, p2.jpg, p3.jpg, pause.mp3, happy-birthday.mp3 (‡∏´‡∏£‡∏∑‡∏≠ .m4a)</span>
</div>
</div>
</div>
</div>

<script>
/* =========================
CONFIG
========================= */
const CONFIG = {
cartoonBirthday: "18/12/2006", // ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á Cartoon (DD/MM/YYYY)
song1: "pause.mp3",
song2: "happy-birthday.mp3", // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô .m4a ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "happy-birthday.m4a"
img1: "p1.jpg",
img2: "p2.jpg",
img3: "p3.jpg",
};

const HIGHLIGHTS = ["Happy Birthday", "Cartoon", "‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ"];

const COUPONS = [
"‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Å‡∏≠‡∏î‡∏ü‡∏£‡∏µ 10 ‡∏ô‡∏≤‡∏ó‡∏µ",
"‡∏ß‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à Cartoon 1 ‡∏ß‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°",
"‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ Photo Booth",
"‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å 10 ‡∏£‡∏≠‡∏ö",
"‡πÇ‡∏≠‡∏ô‡∏ï‡∏±‡∏á‡∏Ñ‡∏∑‡∏ô 10 ‡∏ö‡∏≤‡∏ó",
];

const LETTER = `Happy Birthday ‡∏Ñ‡∏£‡∏±‡∏ö‡∏≠‡πâ‡∏ß‡∏ô ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ò‡∏≠ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ‡∏ß‡∏±‡∏ô ‡∏ó‡∏ô‡∏ü‡∏±‡∏á‡πÄ‡∏£‡∏≤‡∏û‡∏π‡∏î‡πÑ‡∏õ‡∏ô‡∏≤‡∏ô‡πÜ ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏à‡∏Å‡∏±‡∏ô‡∏ö‡πâ‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡πÄ‡∏™‡∏°‡∏≠ ‡∏´‡∏¢‡∏≠‡∏Å‡∏à‡∏±‡πâ‡∏ü ‡∏ô‡∏±‡πà‡∏ô‡πÅ‡∏´‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ‡πÄ‡∏î‡πâ‡∏≠‡∏≠‡πâ‡∏ß‡∏ô ‡∏à‡∏≤‡∏Å PEACE ‡∏™‡∏∏‡∏î‡∏´‡∏•‡πà‡∏≠ ‡∏ñ‡∏∂‡∏á ‡πÄ‡∏ò‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏™‡∏î‡∏á‡∏î‡∏á‡∏≤‡∏° ‡∏™‡∏µ‚Ä¶`;

/* =========================
Steps
0 intro, 1 love, 2 game, 3 gate, 4 m1, 5 m2, 6 m3, 7 ready, 8 letter, 9 color, 10 final
========================= */
let step = 0;

const $ = (id)=>document.getElementById(id);
const toast = (msg)=>{
const t=$("toast");
t.textContent=msg;
t.classList.add("show");
setTimeout(()=>t.classList.remove("show"), 1600);
};
const norm = (s)=> (s ?? "").trim();
const normLower = (s)=> norm(s).toLowerCase();

function setProgress(){
const total = 10;
const pct = Math.min(100, Math.round((step/total)*100));
$("stepLabel").textContent = step;
$("fill").style.width = pct + "%";
}
setProgress();

/* ===== lights ===== */
(function buildLights(){
const el = $("lights");
if(!el) return;
el.innerHTML = "";
const colors = ["#ff4d4d","#66ffcc","#86a8ff","#ffd966","#ff8ad6"];
const count = Math.min(34, Math.max(18, Math.floor(window.innerWidth/24)));
for(let i=0;i<count;i++){
const b = document.createElement("i");
const c = colors[i % colors.length];
b.style.background = c;
b.style.boxShadow = `0 0 16px ${c}55`;
el.appendChild(b);
}
})();

/* ===== SFX / Typewriter Sound ===== */
let audioCtx = null;
let typeSoundOn = true; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
function ensureAudio(){
if(!audioCtx){
audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}
if(audioCtx.state === "suspended") audioCtx.resume();
}
function beep({freq=880, dur=0.06, type="sine", vol=0.03} = {}){
try{
ensureAudio();
const o = audioCtx.createOscillator();
const g = audioCtx.createGain();
o.type = type;
o.frequency.value = freq;
g.gain.value = vol;
o.connect(g); g.connect(audioCtx.destination);
o.start();
o.stop(audioCtx.currentTime + dur);
}catch(e){}
}
function sfxSuccess(){ beep({freq:988,dur:0.08,vol:0.05}); setTimeout(()=>beep({freq:1319,dur:0.10,vol:0.05}), 90); }
function sfxFail(){ beep({freq:220,dur:0.12,type:"square",vol:0.03}); }
function typeTick(){
if(!typeSoundOn) return;
beep({freq: 900 + Math.random()*120, dur: 0.025, type:"square", vol: 0.01});
}

/* ===== Effects: Snow / Confetti / Fireworks ===== */
const c0 = $("snow"), x0 = c0.getContext("2d");
const c1 = $("confetti"), x1 = c1.getContext("2d");
const c2 = $("fire"), x2 = c2.getContext("2d");
let parts=[], sparks=[], fireLooping=false;

function resize(){
c0.width = window.innerWidth; c0.height = window.innerHeight;
c1.width = window.innerWidth; c1.height = window.innerHeight;
c2.width = window.innerWidth; c2.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* snow */
let flakes=[];
function initSnow(){
flakes = Array.from({length: 120}, ()=>({
x: Math.random()*c0.width,
y: Math.random()*c0.height,
r: 0.8 + Math.random()*2.2,
vy: 0.6 + Math.random()*1.8,
vx: -0.4 + Math.random()*0.8,
a: 0.35 + Math.random()*0.45
}));
}
initSnow();
window.addEventListener("resize", initSnow);

function tickSnow(){
x0.clearRect(0,0,c0.width,c0.height);
for(const f of flakes){
f.x += f.vx; f.y += f.vy;
if(f.y > c0.height + 10){ f.y = -10; f.x = Math.random()*c0.width; }
if(f.x < -10) f.x = c0.width + 10;
if(f.x > c0.width + 10) f.x = -10;
x0.beginPath();
x0.arc(f.x,f.y,f.r,0,Math.PI*2);
x0.fillStyle = `rgba(255,255,255,${f.a})`;
x0.fill();
}
requestAnimationFrame(tickSnow);
}
requestAnimationFrame(tickSnow);

/* confetti */
function makePart(){
return {
x: Math.random()*c1.width, y: Math.random()*-c1.height,
r: 3+Math.random()*6,
vx: -1+Math.random()*2,
vy: 2+Math.random()*5,
rot: Math.random()*Math.PI,
vr: -0.12+Math.random()*0.24,
hue: Math.random()*360
};
}
function startConfetti(){
parts = Array.from({length: 140}, ()=>makePart());
requestAnimationFrame(tickConfetti);
}
function burstConfetti(n=140){
for(let i=0;i<n;i++){
const p = makePart();
p.y = Math.random()*c1.height*0.25;
p.vy = 4+Math.random()*7;
parts.push(p);
}
parts = parts.slice(-420);
}
function tickConfetti(){
x1.clearRect(0,0,c1.width,c1.height);
for(const p of parts){
p.x += p.vx; p.y += p.vy; p.rot += p.vr;
if(p.y > c1.height+30){ p.y=-30; p.x=Math.random()*c1.width; }
x1.save();
x1.translate(p.x,p.y); x1.rotate(p.rot);
x1.fillStyle = `hsla(${p.hue},90%,65%,.95)`;
x1.fillRect(-p.r,-p.r,p.r*2,p.r*2);
x1.restore();
}
requestAnimationFrame(tickConfetti);
}
startConfetti();

/* fireworks */
function fireworksBurst(count=10){
for(let i=0;i<count;i++){
const cx = Math.random()*c2.width*0.9 + c2.width*0.05;
const cy = Math.random()*c2.height*0.45 + c2.height*0.05;
const hue = Math.random()*360;
for(let k=0;k<32;k++){
const a = (Math.PI*2) * (k/32);
const sp = 2 + Math.random()*4.5;
sparks.push({
x: cx, y: cy,
vx: Math.cos(a)*sp*(0.7+Math.random()*0.7),
vy: Math.sin(a)*sp*(0.7+Math.random()*0.7),
life: 40 + Math.random()*22,
hue
});
}
}
if(!fireLooping){ fireLooping=true; requestAnimationFrame(tickFire); }
}
function tickFire(){
x2.clearRect(0,0,c2.width,c2.height);
for(const s of sparks){
s.x += s.vx; s.y += s.vy;
s.vy += 0.04;
s.life -= 1;
x2.beginPath();
x2.arc(s.x,s.y,1.6,0,Math.PI*2);
x2.fillStyle = `hsla(${s.hue},95%,70%,${Math.max(0,s.life/60)})`;
x2.fill();
}
sparks = sparks.filter(s=>s.life>0);
if(sparks.length>0) requestAnimationFrame(tickFire);
else { fireLooping=false; x2.clearRect(0,0,c2.width,c2.height); }
}

/* ===== Audio: ‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ===== */
const song1 = $("song1");
const song2 = $("song2");
song1.src = CONFIG.song1;
song2.src = CONFIG.song2;

function stopOther(current){
const other = (current === song1) ? song2 : song1;
if(!other.paused) other.pause();
}
song1.addEventListener("play", ()=>stopOther(song1));
song2.addEventListener("play", ()=>stopOther(song2));

async function togglePlay(audioEl, btnEl, labelPlay, labelPause){
stopOther(audioEl);
audioEl.load();
try{
if(audioEl.paused){
await audioEl.play();
btnEl.textContent = labelPause;
toast("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á üéµ");
}else{
audioEl.pause();
btnEl.textContent = labelPlay;
toast("‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß");
}
}catch(e){
alert("‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ\n\n‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô repo ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏£‡∏á‡πÄ‡∏õ‡πä‡∏∞\n- pause.mp3\n- happy-birthday.mp3 ‡∏´‡∏£‡∏∑‡∏≠ .m4a\n\n‡∏ö‡∏ô iPad ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏≠‡∏á 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
}
}

/* ===== UI Step ===== */
function show(id){ $(id).classList.remove("hidden"); }
function hide(id){ $(id).classList.add("hidden"); }

function goStep(newStep){
step = newStep;
setProgress();

["introPanel","lovePanel","gamePanel","gatePanel","missionPanel","letterPanel","colorPanel","finalPanel"].forEach(hide);

if(step===0) show("introPanel");
if(step===1) show("lovePanel");
if(step===2) show("gamePanel");
if(step===3) show("gatePanel");
if(step>=4 && step<=7) show("missionPanel");
if(step===8) show("letterPanel");
if(step===9) show("colorPanel");
if(step===10) show("finalPanel");
}
goStep(0);

/* ===== Fingerprint Hold + Envelope Open ===== */
let holdRAF=null;
let holdStart=0;
const HOLD_MS = 1600;

function setHoldProgress(pct){
const a = Math.max(0, Math.min(1, pct));
const steps = 36;
const pts = ["50% 50%","50% 0%"];
const angleMax = a * Math.PI*2;
for(let i=0;i<=steps;i++){
const ang = (-Math.PI/2) + (angleMax*(i/steps));
const x = 50 + 50*Math.cos(ang);
const y = 50 + 50*Math.sin(ang);
pts.push(`${x.toFixed(2)}% ${y.toFixed(2)}%`);
}
$("finger").style.setProperty("--wedge", `polygon(${pts.join(",")})`);
}

function holdStartFn(){
ensureAudio(); // iOS gesture
const finger = $("finger");
finger.classList.add("holding");
$("holdText").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô...";
holdStart = performance.now();
setHoldProgress(0);

function tick(){
const pct = (performance.now() - holdStart) / HOLD_MS;
setHoldProgress(pct);
if(pct >= 1){
holdEndFn(true);
return;
}
holdRAF = requestAnimationFrame(tick);
}
holdRAF = requestAnimationFrame(tick);
}
function holdEndFn(success){
const finger = $("finger");
finger.classList.remove("holding");
if(holdRAF){ cancelAnimationFrame(holdRAF); holdRAF=null; }
setHoldProgress(0);

if(success){
$("envStage").classList.add("env-open");
toast("‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
sfxSuccess();
burstConfetti(200);
fireworksBurst(12);

$("holdText").textContent = "‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß";
setTimeout(()=>goStep(1), 1100);
}else{
$("holdText").textContent = "‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏∑‡∏≠";
}
}

(function setupHold(){
const finger = $("finger");
const down = (e)=>{ e.preventDefault(); if(step!==0) return; holdStartFn(); };
const up = (e)=>{ e.preventDefault(); if(step!==0) return; holdEndFn(false); };

finger.addEventListener("pointerdown", down, {passive:false});
window.addEventListener("pointerup", up, {passive:false});
window.addEventListener("pointercancel", up, {passive:false});
})();

$("btnFxIntro").addEventListener("click", ()=>{ burstConfetti(180); fireworksBurst(14); });

/* ===== Love Counter ===== */
function makeDateTH(ddmmyyyy){
const [dd,mm,yyyy]=ddmmyyyy.split("/").map(Number);
const y = yyyy - 543;
return new Date(y, mm-1, dd, 0,0,0,0);
}
const START_DATE = makeDateTH("18/12/2565");

function updateLoveNow(){
const now = new Date();
let ms = now.getTime() - START_DATE.getTime();
if(ms < 0) ms = 0;

const sec = Math.floor(ms / 1000);
const min = Math.floor(sec / 60);
const hr = Math.floor(min / 60);
const day = Math.floor(hr / 24);

$("dNow").textContent = String(day);
$("hNow").textContent = String(hr % 24);
$("mNow").textContent = String(min % 60);
$("sNow").textContent = String(sec % 60);
}
updateLoveNow();
setInterval(updateLoveNow, 1000);

$("btnLoveNext").addEventListener("click", ()=>goStep(2));

/* ===== Timing Game ===== */
let timingRAF=null;
let timingPos=0.0;
let timingDir=1;
let timingRunning=false;
let timingWin=0;
let timingTry=0;

function timingUpdateUI(){
$("timingWin").textContent = String(timingWin);
$("timingTry").textContent = String(timingTry);
}
timingUpdateUI();

function timingStart(){
$("timingErr").textContent = "";
if(timingRunning) return;
timingRunning = true;
$("btnTimingStart").disabled = true;
$("btnTimingStop").disabled = false;

const speed = 0.9;
let last = performance.now();
function loop(now){
if(!timingRunning) return;
const dt = (now-last)/1000;
last = now;

timingPos += timingDir * dt * speed;
if(timingPos >= 1){ timingPos=1; timingDir=-1; }
if(timingPos <= 0){ timingPos=0; timingDir=1; }

$("timingPointer").style.left = (timingPos*100) + "%";
timingRAF = requestAnimationFrame(loop);
}
timingRAF = requestAnimationFrame(loop);
}

function timingStop(){
if(!timingRunning) return;
timingRunning = false;
if(timingRAF){ cancelAnimationFrame(timingRAF); timingRAF=null; }

$("btnTimingStart").disabled = false;
$("btnTimingStop").disabled = true;

timingTry++;
const ok = (timingPos >= 0.42 && timingPos <= 0.58);

if(ok){
timingWin++;
sfxSuccess();
toast("‡πÇ‡∏î‡∏ô‡πÇ‡∏ã‡∏ô‡∏ó‡∏≠‡∏á ‚úÖ");
burstConfetti(140);
}else{
sfxFail();
toast("‡∏û‡∏•‡∏≤‡∏î! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
}
timingUpdateUI();

if(timingWin >= 2){
toast("‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
fireworksBurst(12);
setTimeout(()=>goStep(3), 550);
return;
}
if(timingTry >= 3 && timingWin < 2){
$("timingErr").textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á) ‚Äî ‡∏Å‡∏î‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà";
}
}

function timingReset(){
timingRunning=false;
if(timingRAF){ cancelAnimationFrame(timingRAF); timingRAF=null; }
timingPos = 0;
timingDir = 1;
timingWin = 0;
timingTry = 0;
$("timingPointer").style.left = "0%";
$("btnTimingStart").disabled = false;
$("btnTimingStop").disabled = true;
$("timingErr").textContent = "";
timingUpdateUI();
}

$("btnTimingStart").addEventListener("click", timingStart);
$("btnTimingStop").addEventListener("click", timingStop);
$("btnTimingReset").addEventListener("click", timingReset);

/* ===== ORIGINAL FLOW ===== */
function setMission(title, desc, placeholder){
$("missionTitle").textContent = title;
$("missionDesc").textContent = desc;
$("missionInput").value = "";
$("missionInput").placeholder = placeholder || "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö/‡∏£‡∏´‡∏±‡∏™...";
$("missionErr").textContent = "";
}

function revealImage(which){
const mk = (src, capText)=>{
const img = document.createElement("img");
img.src = src;
const cap = document.createElement("div");
cap.className = "cap";
cap.textContent = capText;
return {img, cap};
};
if(which===1){
const box=$("imgBox1"); box.innerHTML="";
const {img,cap}=mk(CONFIG.img1,"‚úÖ ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1 ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
box.appendChild(img); box.appendChild(cap);
}
if(which===2){
const box=$("imgBox2"); box.innerHTML="";
const {img,cap}=mk(CONFIG.img2,"‚úÖ ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2 ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
box.appendChild(img); box.appendChild(cap);
}
if(which===3){
const box=$("imgBox3"); box.innerHTML="";
const {img,cap}=mk(CONFIG.img3,"‚úÖ ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 3 ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
box.appendChild(img); box.appendChild(cap);
}
}

/* typewriter + highlight */
let typingTimer=null;
function escapeHtml(s){
return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");
}
function applyHighlight(html){
let out = html;
for(const word of HIGHLIGHTS){
const w = escapeHtml(word);
out = out.split(w).join(`<span class="hl">${w}</span>`);
}
return out;
}
function renderTyped(text){
const safe = escapeHtml(text);
const hi = applyHighlight(safe);
$("letterText").innerHTML = hi + `<span class="cursor">‚ñç</span>`;
}
function typeLetter(text){
const btn=$("btnNextAfterLetter");
if(typingTimer) clearInterval(typingTimer);

btn.disabled = true;
$("letterText").innerHTML = `<span class="cursor">‚ñç</span>`;

let i=0;
let current="";
typingTimer = setInterval(()=>{
if(i >= text.length){
clearInterval(typingTimer);
typingTimer=null;
const safe = escapeHtml(current);
$("letterText").innerHTML = applyHighlight(safe);
btn.disabled = false;
return;
}
current += text[i];
if(text[i] !== " " && text[i] !== "\n") typeTick();
renderTyped(current);
i++;
}, 22);
}

/* effects buttons */
$("btnFxGate").addEventListener("click", ()=>{ burstConfetti(180); fireworksBurst(14); });
$("btnFxMission").addEventListener("click", ()=>{ burstConfetti(200); fireworksBurst(12); });

/* audio buttons */
$("btnPlay1").addEventListener("click", ()=> togglePlay(song1, $("btnPlay1"), "‚ñ∂ ‡πÄ‡∏•‡πà‡∏ô/‡∏´‡∏¢‡∏∏‡∏î ‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å", "‚è∏ ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å"));
$("btnPlay2").addEventListener("click", ()=> togglePlay(song2, $("btnPlay2"), "‚ñ∂ ‡πÄ‡∏•‡πà‡∏ô/‡∏´‡∏¢‡∏∏‡∏î ‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢", "‚è∏ ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢"));

/* type sound toggle */
function updateTypeBtn(){
$("btnTypeSound").textContent = typeSoundOn ? "üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡∏µ‡∏î: ‡πÄ‡∏õ‡∏¥‡∏î" : "üîá ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡∏µ‡∏î: ‡∏õ‡∏¥‡∏î";
}
updateTypeBtn();
$("btnTypeSound").addEventListener("click", ()=>{
ensureAudio();
typeSoundOn = !typeSoundOn;
updateTypeBtn();
toast(typeSoundOn ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡∏µ‡∏î" : "‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡∏µ‡∏î");
});

/* gate start */
$("btnStart").addEventListener("click", ()=>{
ensureAudio();
const v = norm($("startPw").value);
$("startErr").textContent = "";

if(v !== CONFIG.cartoonBirthday){
$("startErr").textContent = "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
sfxFail();
return;
}

toast("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
sfxSuccess();
burstConfetti(160);
fireworksBurst(10);

step = 4; setProgress();
hide("gatePanel"); show("missionPanel");
setMission(
"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 1",
"‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á PEACE ‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô?",
"‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö DD/MM/YYYY"
);
});
$("startPw").addEventListener("keydown", (e)=>{ if(e.key==="Enter") $("btnStart").click(); });

/* mission submit */
$("btnSubmit").addEventListener("click", ()=>{
ensureAudio();
const ansRaw = norm($("missionInput").value);
const ansLower = normLower(ansRaw);
$("missionErr").textContent = "";

if(step===4){
if(ansRaw !== "04/05/2007"){
$("missionErr").textContent = "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
sfxFail();
return;
}
revealImage(1);
toast("‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1 ‚úÖ");
sfxSuccess();
burstConfetti(160);
step = 5; setProgress();
setMission(
"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 2",
"‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ Cartoon ‡∏ä‡∏π 2 ‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏≤‡πÉ‡∏ô LINE ‡πÉ‡∏´‡πâ PEACE ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å‡πÉ‡∏ô LINE (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ)",
"‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö..."
);
return;
}

if(step===5){
if(ansRaw !== "Narak Mak" && ansLower !== "narak mak"){
$("missionErr").textContent = "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
sfxFail();
return;
}
revealImage(2);
toast("‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2 ‚úÖ");
sfxSuccess();
fireworksBurst(12);
step = 6; setProgress();
setMission(
"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 3",
"‡πÉ‡∏´‡πâ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ PEACE 10 ‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ô IG (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ)",
"‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö..."
);
return;
}

if(step===6){
if(ansRaw !== "Thank you" && ansLower !== "thank you"){
$("missionErr").textContent = "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
sfxFail();
return;
}
revealImage(3);
toast("‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 3 ‚úÖ");
sfxSuccess();
burstConfetti(220);
fireworksBurst(18);
step = 7; setProgress();
setMission(
"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‚úÖ",
"‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏´‡∏°? ‡∏ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‚Äú‡∏û‡∏£‡πâ‡∏≠‡∏°‚Äù",
"‡∏û‡∏¥‡∏°‡∏û‡πå: ‡∏û‡∏£‡πâ‡∏≠‡∏°"
);
return;
}

if(step===7){
if(ansRaw !== "‡∏û‡∏£‡πâ‡∏≠‡∏°"){
$("missionErr").textContent = "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
sfxFail();
return;
}
toast("‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß üì©");
sfxSuccess();
hide("missionPanel");
step = 8; setProgress();
show("letterPanel");
typeLetter(LETTER);
return;
}
});
$("missionInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") $("btnSubmit").click(); });

/* letter next */
$("btnNextAfterLetter").addEventListener("click", ()=>{
hide("letterPanel");
step = 9; setProgress();
show("colorPanel");
});

/* color */
$("btnColor").addEventListener("click", ()=>{
ensureAudio();
const v = norm($("colorInput").value);
$("colorErr").textContent = "";
if(v !== "‡∏ó‡∏≠‡∏á"){
$("colorErr").textContent = "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
sfxFail();
return;
}
toast("‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚úÖ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢");
sfxSuccess();
fireworksBurst(18);
burstConfetti(240);
hide("colorPanel");
step = 10; setProgress();
show("finalPanel");
});
$("colorInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") $("btnColor").click(); });

/* ===== Gift (‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö) ===== */
let giftPickedThisSession = false;

function showGift(couponText){
$("giftBox").classList.remove("hidden");
$("coupon").innerHTML = `
<div class="title">üéÅ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</div>
<div style="font-size:16px; font-weight:900; color:var(--gold);">${couponText}</div>
<div class="sub" style="margin:10px 0 0 0;">‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î üíõ</div>
`;
}
function resetGiftUI(){
giftPickedThisSession = false;
$("giftBox").classList.add("hidden");
$("coupon").innerHTML = "";
$("btnGift").disabled = false;
$("btnGift").textContent = "‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏•‡∏±‡∏ö üéÅ";
}
resetGiftUI();

$("btnGift").addEventListener("click", ()=>{
ensureAudio();

if(giftPickedThisSession){
toast("‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ‚úÖ");
return;
}

const idx = Math.floor(Math.random() * COUPONS.length);
const pick = COUPONS[idx];

giftPickedThisSession = true;
showGift(pick);

$("btnGift").disabled = true;
$("btnGift").textContent = "‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß ‚úÖ";

burstConfetti(260);
fireworksBurst(16);
sfxSuccess();
toast("‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏•‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß üéÅ");
});
</script>

<!-- =======================
PEACE-BOT (LOCAL CHAT WIDGET)
======================= -->
<style>
.pb-fab{
position:fixed; right:16px; bottom:16px; z-index:9999;
width:56px; height:56px; border-radius:999px;
border:1px solid rgba(255,255,255,.18);
background: linear-gradient(135deg, rgba(102,255,204,.22), rgba(134,168,255,.16));
color:var(--fg);
box-shadow:0 18px 55px rgba(0,0,0,.45);
display:flex; align-items:center; justify-content:center;
cursor:pointer;
user-select:none; -webkit-user-select:none; -webkit-touch-callout:none;
}
.pb-fab:active{ transform: translateY(1px); }

.pb-modal{
position:fixed; inset:0; z-index:9999;
display:none;
background: rgba(0,0,0,.45);
backdrop-filter: blur(6px);
}
.pb-modal.open{ display:block; }

.pb-chat{
position:absolute;
right:16px; bottom:84px;
width:min(380px, calc(100vw - 24px));
height:min(560px, calc(100vh - 140px));
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(10,16,40,.72);
box-shadow:0 24px 80px rgba(0,0,0,.55);
display:flex; flex-direction:column;
overflow:hidden;
}

.pb-head{
padding:12px 12px 10px 12px;
border-bottom:1px solid rgba(255,255,255,.10);
display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
}
.pb-title{ font-weight:900; }
.pb-sub{ margin-top:4px; color:var(--muted); font-size:12px; line-height:1.4; }
.pb-badge{
display:inline-flex; align-items:center;
padding:6px 10px; border-radius:999px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.20);
color:var(--muted); font-size:12px;
white-space:nowrap;
margin-top:6px;
}
.pb-actions{ display:flex; gap:8px; }
.pb-mini{
padding:8px 10px;
border-radius:12px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.18);
color:var(--fg);
cursor:pointer;
font:inherit;
}

.pb-log{
flex:1;
padding:12px;
overflow:auto;
-webkit-overflow-scrolling:touch;
}
.pb-msg{ display:flex; margin:10px 0; }
.pb-msg.me{ justify-content:flex-end; }
.pb-bubble{
max-width: 78%;
padding:10px 12px;
border-radius:14px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.22);
color:var(--fg);
line-height:1.55;
font-size:13px;
white-space:pre-wrap;
}
.pb-msg.me .pb-bubble{
background: rgba(102,255,204,.14);
border-color: rgba(102,255,204,.22);
}
.pb-meta{
font-size:11px;
color: rgba(255,255,255,.55);
margin-top:6px;
}

.pb-foot{
border-top:1px solid rgba(255,255,255,.10);
padding:10px;
display:flex; gap:8px; align-items:center;
background: rgba(0,0,0,.18);
}
.pb-input{
flex:1;
border-radius:12px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.22);
color:var(--fg);
padding:12px 12px;
outline:none;
font:inherit;
}
.pb-send{
border-radius:12px;
padding:12px 14px;
border:1px solid rgba(255,255,255,.14);
background: linear-gradient(135deg, rgba(102,255,204,.22), rgba(134,168,255,.16));
color:var(--fg);
cursor:pointer;
font:inherit;
}

.pb-quick{
display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
}
.pb-chip{
font-size:12px;
padding:8px 10px;
border-radius:999px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.18);
color:var(--muted);
cursor:pointer;
}
</style>

<div class="pb-fab" id="pbFab" aria-label="Open PEACE-BOT">üí¨</div>

<div class="pb-modal" id="pbModal" aria-hidden="true">
<div class="pb-chat" role="dialog" aria-modal="true" aria-label="PEACE-BOT chat">
<div class="pb-head">
<div>
<div class="pb-title">PEACE-BOT</div>
<div class="pb-sub">
‡∏ö‡∏≠‡∏ó‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡πÑ‡∏ï‡∏•‡πå ‚ÄúPEACE‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö Cartoon üíõ
<div class="pb-badge">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏ä‡∏ó‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á PEACE</div>
</div>
</div>
<div class="pb-actions">
<button class="pb-mini" id="pbReset">‡∏•‡πâ‡∏≤‡∏á</button>
<button class="pb-mini" id="pbClose">‡∏õ‡∏¥‡∏î</button>
</div>
</div>

<div class="pb-log" id="pbLog"></div>

<div style="padding:0 12px 10px 12px;">
<div class="pb-quick" id="pbQuick"></div>
</div>

<div class="pb-foot">
<input class="pb-input" id="pbInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö PEACE-BOT..." autocomplete="off" />
<button class="pb-send" id="pbSend">‡∏™‡πà‡∏á</button>
</div>
</div>
</div>

<script>
(function(){
// ===== ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤ =====
const PB = {
botName: "PEACE-BOT",
userName: "Cartoon",
creatorName: "PEACE",
phrases: ["‡∏á‡πâ‡∏ß‡∏¢‡∏¢‡∏¢‡∏¢", "‡∏î‡∏ß‡∏Å‡∏Å‡∏Å‡∏Å", "‡∏≠‡∏ß‡∏ö‡∏≠‡πâ‡∏ß‡∏ô‡∏≠‡∏∏‡∏™‡∏ï‡∏±‡∏ô", "‡πÄ‡∏≠‡πâ‡∏≤ ‡∏î‡∏ß‡∏Å‡∏ó‡∏ß‡∏á"],
quickChips: [
"‡∏™‡∏∏‡∏î‡∏´‡∏•‡πà‡∏≠",
"‡∏û‡∏µ‡∏™",
"‡∏î‡∏ß‡∏Å",
"‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡πÑ‡∏´‡∏°",
"‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏∑‡∏≠‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏™‡∏î‡∏á‡∏î‡∏á‡∏≤‡∏°"
],
memory: {
coupleDateTH: "18/12/2565",
flowerColorAnswer: "‡∏ó‡∏≠‡∏á"
}
};

const q = (id)=>document.getElementById(id);
const fab = q("pbFab");
const modal = q("pbModal");
const log = q("pbLog");
const input = q("pbInput");
const send = q("pbSend");
const close = q("pbClose");
const reset = q("pbReset");
const quick = q("pbQuick");

const pad2 = (n)=> String(n).padStart(2,"0");
function nowTime(){
const d=new Date();
return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
}
function addMsg(text, who="bot"){
const wrap = document.createElement("div");
wrap.className = "pb-msg" + (who==="me" ? " me":"");

const bubble = document.createElement("div");
bubble.className="pb-bubble";
bubble.textContent = text;

const meta = document.createElement("div");
meta.className="pb-meta";
meta.textContent = (who==="me" ? PB.userName : PB.botName) + " ‚Ä¢ " + nowTime();

bubble.appendChild(meta);
wrap.appendChild(bubble);
log.appendChild(wrap);

log.scrollTop = log.scrollHeight;
}

function addBot(text){
const salt = PB.phrases[Math.floor(Math.random()*PB.phrases.length)];
addMsg(text.replace(/\{salt\}/g, salt), "bot");
}

function normalize(s){ return (s||"").trim(); }
function lower(s){ return normalize(s).toLowerCase(); }

function makeDateTH(ddmmyyyy){
const [dd,mm,yyyy]=ddmmyyyy.split("/").map(Number);
const y = yyyy - 543;
return new Date(y, mm-1, dd, 0,0,0,0);
}
function coupleSince(){
const start = makeDateTH(PB.memory.coupleDateTH);
const now = new Date();
let ms = now - start;
if(ms < 0) ms = 0;
const sec = Math.floor(ms/1000);
const min = Math.floor(sec/60);
const hr = Math.floor(min/60);
const day = Math.floor(hr/24);
return {day, hr: hr%24, min: min%60};
}

function reply(text){
const raw = normalize(text);
const t = lower(text);

if(t === "/help") return `‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: /help /clear /about`;
if(t === "/about") return `PEACE-BOT (‡∏ö‡∏≠‡∏ó‡∏à‡∏≥‡∏•‡∏≠‡∏á) ‡∏Ç‡∏≠‡∏á ${PB.creatorName} ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${PB.userName} üíõ`;
if(t === "/clear") return "__CLEAR__";

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å "‡∏™‡∏∏‡∏î‡∏´‡∏•‡πà‡∏≠" -> ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô "‡∏á‡πâ‡∏ß‡∏¢‡∏¢‡∏¢‡∏¢‡∏¢ ‡πÄ‡∏Ç‡∏¥‡∏ô"
if(t.includes("‡∏™‡∏∏‡∏î‡∏´‡∏•‡πà‡∏≠")){
return `‡∏á‡πâ‡∏ß‡∏¢‡∏¢‡∏¢‡∏¢‡∏¢ ‡πÄ‡∏Ç‡∏¥‡∏ô üò≥`;
}
// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å "‡∏î‡∏ß‡∏Å" (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∏‡∏ì) -> ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô "‡πÄ‡∏≠‡πâ‡∏≤ ‡∏î‡∏ß‡∏Å‡∏ó‡∏ß‡∏á"
if(t === "‡∏î‡∏ß‡∏Å" || t.includes(" ‡∏î‡∏ß‡∏Å") || t.startsWith("‡∏î‡∏ß‡∏Å")){
return `‡πÄ‡∏≠‡πâ‡∏≤ ‡∏î‡∏ß‡∏Å‡∏ó‡∏ß‡∏á üòå`;
}
// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å "‡∏û‡∏µ‡∏™"
if(t === "‡∏û‡∏µ‡∏™" || t.includes("‡∏û‡∏µ‡∏™")){
return `‡∏ß‡πà‡∏≤‡πÑ‡∏á‡∏≠‡πâ‡∏ß‡∏ô üòè`;
}

// inside joke: ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ + ‡∏™‡∏µ‡∏ó‡∏≠‡∏á
if(t.includes("‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏∑‡∏≠‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏™‡∏î‡∏á‡∏î‡∏á‡∏≤‡∏°")){
return `‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏µ‡πÑ‡∏£‡∏•‡πà‡∏∞ üòå`;
}
if(t === "‡∏™‡∏µ" || t === "‡∏™‡∏µ?" || t.includes("‡∏™‡∏µ‡∏≠‡∏∞‡πÑ‡∏£") || t.includes("‡∏™‡∏µ‡πÑ‡∏£")){
return `${PB.memory.flowerColorAnswer}`;
}

if(t.includes("‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á") || t.includes("miss")){
return `‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡∏î‡∏¥ ‡∏≠‡∏ß‡∏ö‡∏≠‡πâ‡∏ß‡∏ô‡∏≠‡∏∏‡∏™‡∏ï‡∏±‡∏ô üíõ`;
}
if(t.includes("‡∏£‡∏±‡∏Å") || t.includes("‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å")){
return `‡∏£‡∏±‡∏Å‡∏î‡∏¥ ‡∏á‡πâ‡∏ß‡∏¢‡∏¢‡∏¢‡∏¢ üòå`;
}
if(t.includes("‡∏ß‡∏±‡∏ô‡∏Ñ‡∏ö") || t.includes("‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô") || t.includes("‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö")){
const {day, hr, min} = coupleSince();
return `‡∏Ñ‡∏ö‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ${day} ‡∏ß‡∏±‡∏ô ${hr} ‡∏ä‡∏°. ${min} ‡∏ô‡∏≤‡∏ó‡∏µ üòè`;
}
if(t.includes("‡∏´‡∏¥‡∏ß")){
return `‡πÑ‡∏õ‡∏Å‡∏¥‡∏ô‡πÑ‡∏£‡∏î‡∏µ‡∏≠‡πâ‡∏ß‡∏ô üçΩÔ∏è`;
}
if(t.includes("‡∏á‡∏≠‡∏ô")){
return `‡∏≠‡∏¢‡πà‡∏≤‡∏û‡∏∂‡πà‡∏á‡∏á‡∏≠‡∏ô‡∏î‡∏¥ ‡∏î‡∏ß‡∏Å‡∏Å‡∏Å‡∏Å üòè`;
}
if(t.includes("‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢") || t.includes("‡∏ó‡πâ‡∏≠") || t.includes("‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î")){
return `‡∏û‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡πâ‡∏ß‡∏ô ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏Ñ‡πâ‡∏≤‡∏î‡∏π‡πÅ‡∏• üòå`;
}

const fb = [
`‡∏´‡∏∑‡∏° ‡∏ß‡πà‡∏≤‡πÑ‡∏á‡∏ô‡∏∞‡∏≠‡πâ‡∏ß‡∏ô üòè`,
`‡∏î‡∏ß‡∏Å‡∏Å‡∏Å‡∏Å ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏î‡∏¥`,
`‡∏á‡πâ‡∏ß‡∏¢‡∏¢‡∏¢‡∏¢ ‡πÄ‡∏Ç‡∏¥‡∏ô‡∏•‡∏∞‡∏ô‡∏∞`,
`‡∏≠‡∏ß‡∏ö‡∏≠‡πâ‡∏ß‡∏ô‡∏≠‡∏∏‡∏™‡∏ï‡∏±‡∏ô üòå`
];
return fb[Math.floor(Math.random()*fb.length)];
}

function openChat(){
modal.classList.add("open");
modal.setAttribute("aria-hidden","false");
setTimeout(()=>input.focus(), 50);
if(!log.dataset.inited){
log.dataset.inited="1";
addBot(`‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ {salt} ‡∏ß‡πà‡∏≤‡πÑ‡∏á‡∏≠‡πâ‡∏ß‡∏ô üòè`);
addBot(`‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÄ‡∏•‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ`);
}
}
function closeChat(){
modal.classList.remove("open");
modal.setAttribute("aria-hidden","true");
}

function sendMsg(){
const text = normalize(input.value);
if(!text) return;
addMsg(text, "me");
input.value = "";

const r = reply(text);
if(r === "__CLEAR__"){
log.innerHTML = "";
log.dataset.inited = "";
addBot(`‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß {salt}`);
return;
}
const delay = 220 + Math.random()*300;
setTimeout(()=>addBot(r), delay);
}

function buildChips(){
quick.innerHTML = "";
PB.quickChips.forEach(ch=>{
const b = document.createElement("button");
b.className="pb-chip";
b.type="button";
b.textContent = ch;
b.addEventListener("click", ()=>{
input.value = ch;
sendMsg();
});
quick.appendChild(b);
});
}
buildChips();

fab.addEventListener("click", openChat);
close.addEventListener("click", closeChat);
modal.addEventListener("click", (e)=>{ if(e.target===modal) closeChat(); });
send.addEventListener("click", sendMsg);
input.addEventListener("keydown", (e)=>{ if(e.key==="Enter") sendMsg(); });
reset.addEventListener("click", ()=>{
log.innerHTML = "";
log.dataset.inited = "";
addBot(`‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó‡πÅ‡∏•‡πâ‡∏ß {salt}`);
});
})();
</script>

</body>
</html>
